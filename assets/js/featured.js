(function(){
  const container=document.getElementById('featured-posts');
  if(!container) return;
  const track=container.querySelector('.featured-track');
  const navPrev=container.querySelector('.fp-nav.prev');
  const navNext=container.querySelector('.fp-nav.next');
  const slugs=JSON.parse(container.getAttribute('data-featured')||'[]');

  // Fetch JSON index generated by Hugo (index.json) then filter by featured slugs
  fetch('/index.json')
    .then(r=>r.ok?r.json():[]) 
    .then(items=>{
      const posts=items.filter(p=>slugs.includes(p.slug||p.permalink.split('/').filter(Boolean).pop()));
      posts.forEach(p=>{
        const card=document.createElement('article');
        card.className='featured-card';
        const title=document.createElement('h3');
        const link=document.createElement('a');
        link.href=p.permalink; link.textContent=p.title; link.setAttribute('aria-label',p.title);
        title.appendChild(link);
        const desc=document.createElement('p');
        desc.textContent=(p.summary||'').slice(0,120).replace(/\s+$/,'') + (p.summary && p.summary.length>120?'â€¦':'');
        const meta=document.createElement('div');
        meta.className='featured-meta';
        if(p.date){
          const d=new Date(p.date); meta.textContent=d.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
        }
        card.appendChild(title);
        card.appendChild(desc);
        card.appendChild(meta);
        track.appendChild(card);
      });
    })
    .catch(()=>{});

  function scrollDir(dir){
    const width=track.getBoundingClientRect().width;
    track.scrollBy({left:dir* (width*0.6),behavior:'smooth'});
  }
  navPrev.addEventListener('click',()=>scrollDir(-1));
  navNext.addEventListener('click',()=>scrollDir(1));
})();
